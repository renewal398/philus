<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Make a Wish - Happy New Year</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(to top, #000428, #004e92);
      color: white;
      font-family: 'Georgia', serif;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    .balloon {
      position: absolute;
      width: 80px;
      height: 100px;
      bottom: -150px;
      cursor: pointer;
      transition: transform 0.2s;
      animation: floatUp 7s ease-out forwards;
      z-index: 5;
    }

    .balloon:hover {
      transform: scale(1.15) rotate(5deg);
    }

    @keyframes floatUp {
      0% {
        bottom: -150px;
        transform: translateX(0) rotate(0deg);
      }
      100% {
        bottom: 40%;
        transform: translateX(var(--drift, 0px)) rotate(var(--rotation, 5deg));
      }
    }

    .balloon-body {
      width: 80px;
      height: 100px;
      background: radial-gradient(circle at 30% 30%, #ff6b9d, #c44569);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      position: relative;
      box-shadow: inset -10px -10px 20px rgba(0,0,0,0.3);
      animation: floatBob 2s ease-in-out infinite;
    }

    @keyframes floatBob {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(3deg); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .balloon-string {
      position: absolute;
      width: 2px;
      height: 80px;
      background: rgba(255,255,255,0.5);
      bottom: -80px;
      left: 50%;
      transform: translateX(-50%);
    }

    .balloon-shine {
      position: absolute;
      width: 20px;
      height: 30px;
      background: rgba(255,255,255,0.6);
      border-radius: 50%;
      top: 15px;
      left: 20px;
      filter: blur(5px);
    }

    .flower {
      position: absolute;
      font-size: 40px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.5s ease;
      will-change: transform, opacity;
    }

    @keyframes burst {
      0% {
        transform: translate(0, 0) scale(0) rotate(0deg);
        opacity: 0;
      }
      30% {
        opacity: 1;
        transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--rotation, 180deg));
      }
      100% {
        opacity: 1;
        transform: translate(var(--tx), var(--ty)) scale(1.2) rotate(var(--rotation, 360deg));
      }
    }

    @keyframes floatDown {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(var(--fall-distance, 100vh)) rotate(var(--fall-rotation, 720deg)) translateX(var(--drift-x, 0px));
        opacity: 0.3;
      }
    }

    @keyframes formText {
      0% {
        opacity: 1;
      }
      100% {
        opacity: 1;
        transform: scale(1.2);
      }
    }

    .firework {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      animation: fireworkFade 1.5s ease-out forwards;
    }

    @keyframes fireworkFade {
      0% {
        opacity: 1;
        transform: translate(0, 0);
      }
      100% {
        opacity: 0;
        transform: translate(var(--tx), var(--ty)) scale(0);
      }
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confettiFall 4s ease-out forwards;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .wish-container {
      z-index: 10;
      text-align: center;
      animation: fadeIn 1s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .wish-container h1 {
      font-size: 48px;
      margin-bottom: 30px;
      text-shadow: 0 0 20px rgba(255,255,255,0.5);
      animation: glow 2s ease-in-out infinite;
    }

    @keyframes glow {
      0%, 100% { text-shadow: 0 0 20px rgba(255,255,255,0.5); }
      50% { text-shadow: 0 0 30px rgba(255,255,255,0.8), 0 0 40px rgba(0,116,204,0.6); }
    }

    .wish-container.hidden {
      display: none;
    }

    .wish-container input {
      padding: 15px 30px;
      font-size: 20px;
      width: 350px;
      border: 2px solid #fff;
      border-radius: 30px;
      outline: none;
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      transition: 0.3s;
      margin-bottom: 20px;
      text-align: center;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    .wish-container input::placeholder {
      color: rgba(255,255,255,0.7);
    }

    .wish-container input:focus {
      border-color: #ff6b9d;
      background: rgba(255, 255, 255, 0.25);
      transform: scale(1.05);
    }

    .wish-container button {
      padding: 15px 35px;
      font-size: 20px;
      border: none;
      border-radius: 30px;
      background: linear-gradient(90deg, #ff6b9d, #c44569);
      color: white;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(255,107,157,0.4);
      transition: all 0.3s ease;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .wish-container button:hover {
      background: linear-gradient(90deg, #c44569, #ff6b9d);
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 25px rgba(255,107,157,0.6);
    }

    .wish {
      position: fixed;
      white-space: nowrap;
      font-size: 36px;
      text-shadow: 0 0 20px rgba(255,215,0,1), 0 0 30px rgba(255,107,157,0.8), 0 0 40px rgba(138,43,226,0.6);
      font-weight: bold;
      z-index: 15;
      font-family: 'Brush Script MT', cursive, 'Lucida Handwriting', fantasy;
      background: linear-gradient(45deg, #ffd700, #ff6b9d, #ba55d3, #00d4ff);
      background-size: 300% 300%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: fly 8s ease-out forwards, wishGradient 3s ease infinite;
      letter-spacing: 2px;
      filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
      left: 50%;
      transform: translateX(-50%);
    }

    @keyframes wishGradient {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    @keyframes fly {
      0% {
        bottom: -50px;
        transform: translateX(-50%) scale(0.8) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
        transform: translateX(-50%) scale(1.2) rotate(3deg);
      }
      25% {
        transform: translateX(-50%) scale(1.5) rotate(-2deg);
        opacity: 1;
      }
      50% {
        transform: translateX(-50%) scale(1.4) rotate(2deg);
        opacity: 1;
      }
      75% {
        transform: translateX(-50%) scale(1.2) rotate(-1deg);
        opacity: 1;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        bottom: 110%;
        transform: translateX(-50%) scale(0.8) rotate(0deg);
        opacity: 0;
      }
    }

    .sparkle {
      position: absolute;
      width: 3px;
      height: 3px;
      background: white;
      border-radius: 50%;
      animation: sparkleAnim 1s ease-out forwards;
      box-shadow: 0 0 5px white;
    }

    @keyframes sparkleAnim {
      0% {
        opacity: 1;
        transform: translate(0, 0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translate(var(--sx), var(--sy)) scale(0);
      }
    }

    @keyframes twinkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.3; transform: scale(0.8); }
    }
  </style>
</head>
<body>
  <canvas id="stars"></canvas>

  <div class="wish-container" id="wishContainer">
    <h1>‚ú® Make a New Year Wish ‚ú®</h1>
    <input type="text" id="wishInput" placeholder="Enter your wish...">
    <button onclick="makeWish()">Send Wish üéà</button>
  </div>

  <script>
    // Canvas for flying stars
    const canvas = document.getElementById('stars');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let stars = [];
    const starCount = 200;

    function createStars() {
      for (let i = 0; i < starCount; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          radius: Math.random() * 2.5,
          speed: Math.random() * 0.5 + 0.2,
          twinkleOffset: Math.random() * 1000,
        });
      }
    }

    function drawStars() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      stars.forEach((star, i) => {
        const twinkle = 0.5 + 0.5 * Math.sin((Date.now() + star.twinkleOffset) / 500);
        ctx.fillStyle = `rgba(255, 255, 255, ${twinkle})`;
        ctx.beginPath();
        ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
        ctx.fill();
      });
    }

    function moveStars() {
      stars.forEach((star) => {
        star.y -= star.speed;
        if (star.y < 0) {
          star.y = canvas.height;
          star.x = Math.random() * canvas.width;
        }
      });
    }

    function animate() {
      drawStars();
      moveStars();
      requestAnimationFrame(animate);
    }

    createStars();
    animate();

    // Create and launch balloon
    function createBalloon() {
      const balloon = document.createElement('div');
      balloon.className = 'balloon';
      balloon.style.left = '50%';
      balloon.style.transform = 'translateX(-50%)';
      balloon.style.setProperty('--drift', `${(Math.random() - 0.5) * 100}px`);
      balloon.style.setProperty('--rotation', `${(Math.random() - 0.5) * 20}deg`);
      
      balloon.innerHTML = `
        <div class="balloon-body">
          <div class="balloon-shine"></div>
        </div>
        <div class="balloon-string"></div>
      `;
      
      document.body.appendChild(balloon);
      
      setTimeout(() => {
        balloon.style.cursor = 'pointer';
        balloon.onclick = () => burstBalloon(balloon);
        
        // Auto-burst after 3 seconds if user doesn't click
        setTimeout(() => {
          if (document.body.contains(balloon)) {
            burstBalloon(balloon);
          }
        }, 3000);
      }, 7000);
      
      return balloon;
    }

    // Burst balloon into flowers
    function burstBalloon(balloon) {
      const rect = balloon.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      // Remove balloon
      balloon.remove();
      
      // Create burst effect
      createFireworks(centerX, centerY);
      
      // Create realistic flower confetti - much more to fill the screen
      const flowers = ['üå∏', 'üå∫', 'üåº', 'üåª', 'üå∑', 'üåπ', 'üíê', 'üèµÔ∏è', 'ü™∑', 'üåµ'];
      const flowerElements = [];
      const totalFlowers = 150; // Many more flowers to fill screen
      
      for (let i = 0; i < totalFlowers; i++) {
        const flower = document.createElement('div');
        flower.className = 'flower';
        flower.textContent = flowers[Math.floor(Math.random() * flowers.length)];
        flower.style.left = centerX + 'px';
        flower.style.top = centerY + 'px';
        
        // Random burst direction - full 360 degrees
        const angle = (Math.PI * 2 * i) / totalFlowers + (Math.random() - 0.5) * 0.5;
        const distance = 100 + Math.random() * 300; // Vary the distance more
        const tx = Math.cos(angle) * distance;
        const ty = Math.sin(angle) * distance;
        
        flower.style.setProperty('--tx', tx + 'px');
        flower.style.setProperty('--ty', ty + 'px');
        flower.style.setProperty('--rotation', (Math.random() * 720 - 360) + 'deg');
        
        // Random fall properties
        const fallDistance = window.innerHeight - centerY + 100;
        const driftX = (Math.random() - 0.5) * 200;
        const fallRotation = Math.random() * 1440 - 720;
        
        flower.style.setProperty('--fall-distance', fallDistance + 'px');
        flower.style.setProperty('--drift-x', driftX + 'px');
        flower.style.setProperty('--fall-rotation', fallRotation + 'deg');
        
        document.body.appendChild(flower);
        flowerElements.push({ element: flower, tx, ty });
        
        // Burst animation
        setTimeout(() => {
          flower.style.animation = 'burst 1.5s ease-out forwards';
        }, Math.random() * 100);
      }
      
      // After burst, make flowers fall like confetti
      setTimeout(() => {
        flowerElements.forEach((item, i) => {
          setTimeout(() => {
            item.element.style.animation = `floatDown ${3 + Math.random() * 2}s ease-in forwards`;
          }, i * 15); // Stagger the falling
        });
      }, 1500);
      
      // Show "HAPPY NEW YEAR" text after flowers spread
      setTimeout(() => {
        showNewYearText();
      }, 2000);
      
      // Create confetti
      createConfetti(centerX, centerY);
    }

    function createFireworks(x, y) {
      const colors = ['#ff6b9d', '#ffd93d', '#6bcf7f', '#4d96ff', '#c44569'];
      for (let i = 0; i < 50; i++) {
        const firework = document.createElement('div');
        firework.className = 'firework';
        firework.style.left = x + 'px';
        firework.style.top = y + 'px';
        firework.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        const angle = (Math.PI * 2 * i) / 50;
        const distance = 100 + Math.random() * 100;
        firework.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
        firework.style.setProperty('--ty', Math.sin(angle) * distance + 'px');
        
        document.body.appendChild(firework);
        
        setTimeout(() => firework.remove(), 1500);
      }
    }

    function createConfetti(x, y) {
      const colors = ['#ff6b9d', '#ffd93d', '#6bcf7f', '#4d96ff', '#c44569', '#fff'];
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = (x + (Math.random() - 0.5) * 200) + 'px';
        confetti.style.top = y + 'px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        
        document.body.appendChild(confetti);
        
        setTimeout(() => confetti.remove(), 4000);
      }
    }

    function showNewYearText() {
      const textContainer = document.createElement('div');
      textContainer.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 100;
        text-align: center;
        font-size: 72px;
        font-weight: bold;
        font-family: 'Georgia', serif;
        color: white;
        text-shadow: 0 0 30px rgba(255,215,0,1), 0 0 50px rgba(255,107,157,0.8), 0 0 70px rgba(138,43,226,0.6);
        animation: fadeInScale 2s ease-out forwards;
        pointer-events: none;
      `;
      
      textContainer.innerHTML = `
        <div style="margin-bottom: 20px;">HAPPY NEW YEAR</div>
        <div style="font-size: 48px; margin-top: 10px;"></div>
      `;
      
      document.body.appendChild(textContainer);
      
      // Add fade in scale animation
      const style = document.createElement('style');
      style.textContent = `
        @keyframes fadeInScale {
          0% {
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
          }
          100% {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
          }
        }
      `;
      document.head.appendChild(style);
      
      createSparkles(window.innerWidth / 2, window.innerHeight / 2);
    }

    function arrangeFlowersToText(flowerElements) {
      const text = "HAPPY NEW YEAR";
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;
      
      // Define letter positions more precisely
      const letters = text.split('');
      const letterSpacing = 55;
      const lineHeight = 80;
      
      // Split into two lines: "HAPPY NEW" and "YEAR"
      const line1 = "HAPPY NEW";
      const line2 = "YEAR";
      
      const line1Width = line1.length * letterSpacing;
      const line2Width = line2.length * letterSpacing;
      
      const positions = [];
      
      // First line positions
      for (let i = 0; i < line1.length; i++) {
        positions.push({
          x: centerX - line1Width / 2 + i * letterSpacing,
          y: centerY - lineHeight / 2,
          char: line1[i]
        });
      }
      
      // Second line positions
      for (let i = 0; i < line2.length; i++) {
        positions.push({
          x: centerX - line2Width / 2 + i * letterSpacing,
          y: centerY + lineHeight / 2,
          char: line2[i]
        });
      }
      
      // Assign flowers to positions
      flowerElements.forEach((item, i) => {
        if (i < positions.length) {
          const pos = positions[i];
          
          item.element.style.transition = 'all 1.8s cubic-bezier(0.68, -0.55, 0.265, 1.55)';
          item.element.style.transitionDelay = (i * 0.05) + 's';
          item.element.style.left = pos.x + 'px';
          item.element.style.top = pos.y + 'px';
          item.element.style.fontSize = '60px';
          item.element.style.animation = 'formText 0.5s ease forwards';
          item.element.style.textShadow = '0 0 20px rgba(255,215,0,0.8), 0 0 30px rgba(255,255,255,0.6)';
          item.element.textContent = pos.char;
        } else {
          // Extra flowers fade away
          item.element.style.transition = 'all 1s ease';
          item.element.style.opacity = '0';
          setTimeout(() => item.element.remove(), 1000);
        }
      });
      
      setTimeout(() => {
        createSparkles(centerX, centerY);
      }, 2000);
    }

    function createSparkles(x, y) {
      for (let i = 0; i < 50; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = (x + (Math.random() - 0.5) * 600) + 'px';
        sparkle.style.top = (y + (Math.random() - 0.5) * 100) + 'px';
        
        const sx = (Math.random() - 0.5) * 100;
        const sy = (Math.random() - 0.5) * 100;
        sparkle.style.setProperty('--sx', sx + 'px');
        sparkle.style.setProperty('--sy', sy + 'px');
        
        document.body.appendChild(sparkle);
        
        setTimeout(() => sparkle.remove(), 1000);
      }
    }

    // Flying wish logic
    function makeWish() {
      const input = document.getElementById('wishInput');
      const wishText = input.value.trim();

      if (wishText === '') return;

      let flyingText = wishText;

      if (wishText.toLowerCase().startsWith("i wish for")) {
        flyingText = wishText.substring(10).trim();
      } else if (wishText.toLowerCase().startsWith("i wish")) {
        flyingText = wishText.substring(6).trim();
      }

      const wishContainer = document.getElementById('wishContainer');
      wishContainer.classList.add('hidden');

      const wish = document.createElement('div');
      wish.className = 'wish';
      wish.textContent = flyingText || "Your wish!";

      document.body.appendChild(wish);

      // Save wish to file
      saveWishToFile(flyingText || "Your wish!");

      setTimeout(() => {
        wish.remove();
        const balloon = createBalloon();
        
        // Add a pulsing indicator to show it's clickable
        balloon.style.animation = 'floatUp 7s ease-out forwards, pulse 1s ease-in-out infinite 7s';
      }, 3000);

      setTimeout(() => {
        wish.remove();
      }, 8000);
    }

    // Save wish to text file
    function saveWishToFile(wishText) {
      const timestamp = new Date().toLocaleString();
      const wishEntry = `[${timestamp}] ${wishText}\n`;
      
      // Create a blob with the wish text
      const blob = new Blob([wishEntry], { type: 'text/plain' });
      
      // Check if we can use the File System Access API
      if ('showSaveFilePicker' in window) {
        // Modern browser with File System Access API
        saveWithFileSystemAPI(wishEntry);
      } else {
        // Fallback: trigger download
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'wishes.txt';
        a.click();
        URL.revokeObjectURL(url);
      }
    }

    async function saveWithFileSystemAPI(wishEntry) {
      try {
        // This will prompt user once to select/create wishes.txt
        const handle = await window.showSaveFilePicker({
          suggestedName: 'wishes.txt',
          types: [{
            description: 'Text Files',
            accept: { 'text/plain': ['.txt'] }
          }]
        });
        
        const writable = await handle.createWritable();
        
        // Try to read existing content first
        try {
          const file = await handle.getFile();
          const existingContent = await file.text();
          await writable.write(existingContent);
        } catch (e) {
          // File doesn't exist yet, that's okay
        }
        
        await writable.write(wishEntry);
        await writable.close();
      } catch (err) {
        console.log('File save cancelled or error:', err);
      }
    }
  </script>
</body>
</html>